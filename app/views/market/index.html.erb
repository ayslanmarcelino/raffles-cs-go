<%= search_form_for @q, url: market_index_path do |f| %>
  <div class="d-flex mb-2">
    <%= f.text_field :description_cont, placeholder: 'Qual skin você está procurando?', class: 'form-control col-md-11' %>
    <%= button_tag(class: 'btn btn-dark') do %>
      <i class="fas fa-search"></i>
      <%= t('.search') %>
    <% end %>
  </div>
<% end %>
<p>
  <a class="btn btn-dark"
     data-toggle="collapse"
     href="#filter"
     role="button"
     aria-expanded="false"
     aria-controls="filter">
    <i class="fas fa-filter"></i>
    <%= t('.filter') %>
  </a>
</p>
<div class="collapse" id="filter">
  <div class="card card-body mb-2">
    <%= search_form_for @q, url: market_index_path do |f| %>
      <% @skins.pluck(:is_stattrak).each do |is_stattrak| %>
        <% if is_stattrak %>
          <%= check_box_tag('q[is_stattrak_in][]', is_stattrak) %>
          <%= f.label('Stattrak') %><br>
        <% end %>
      <% end %>
      <% @skins.pluck(:has_sticker).each do |has_sticker| %>
        <% if has_sticker %>
          <%= check_box_tag('q[has_sticker_in][]', has_sticker) %>
          <%= f.label(:has_sticker) %><br>
        <% end %>
      <% end %>
      <%= f.select :type_weapon_eq, type_weapon_collection, { include_blank: 'Selecione o tipo de arma' }, class: 'form-control col-md-12 mb-1' %>
      <%= f.select :type_skin_eq, type_skin_collection, { include_blank: 'Selecione o tipo de skin' }, class: 'form-control col-md-12 mb-1' %>
      <%= f.select :exterior_eq, exterior_collection, { include_blank: 'Selecione o exterior' }, class: 'form-control col-md-12 mb-1' %>
      <hr>
      <div>
        <%= link_to url_for, class: 'btn btn-secondary' do %>
          <i class="fas fa-broom"></i>
          <%= t('.clear') %>
        <% end %>
        <%= button_tag(class: 'btn btn-dark') do %>
          <i class="fas fa-search"></i>
          <%= t('.search') %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<div class="grid-view">
  <% @skins.each do |skin| %>
    <div class="mb-3 mr-3 market-card">
      <% if skin.expiration_date.present? && time_tradelock_integer(skin.expiration_date).positive? %>
        <div class="tag-available bg-red">
          <%= t('.releases_on') %> <%= time_tradelock(skin.expiration_date) %>
        </div>
      <% else %>
        <div class="tag-available bg-green">
          <%= t('.available') %>
        </div>
      <% end %>
      <% if skin.inspect_url.present? %>
        <a class="btn btn-outline-light btn-sm mt-2 ml-2" href="<%= skin.inspect_url %>">
          <%= t('.inspect_in_game') %>
        </a>
      <% end %>
      <div class="col-lg-12">
        <%= image_tag(skin.image_skin, width: 300) %>
      </div>
      <div class="card-body p-3">
        <% if skin.has_sticker %>
          <div class="market-sticker">
            <% skin.image_sticker.each do |sticker| %>
              <%= image_tag(sticker, width: 65) %>
            <% end %>
          </div>
        <% end %>
        <h5 class="card-title font-weight-bold fuchsia-rose-text mb-0 market-description" style="color: #<%= skin.description_color %>;">
          <%= skin.description %>
        </h5>
        <p class="mb-0">
          <% if skin.exterior != 'Nenhum' %>
            <%= skin.exterior %>
          <% end %>
        </p>
        <ul class="list-inline">
          <% if positive_value?(skin.float) %>
            <div>
              <i class="fas fa-arrow-down float-left fs-10" style="margin-left: <%= skin.float * 100 %>%;"></i>
              <div class="progress float-chart"></div>
              <%= t('.float') %>: <%= skin.float %>
            </div>
          <% end %>
        </ul>
        <div class="chili-pepper-text mb-0 market-prices">
          <% if skin.price_steam > skin.price_csmoney %>
            <span class="badge badge-success tag-sale">
              <%= sale_percentage(skin.sale_price, skin.price_steam) %>% OFF
            </span>
          <% else %>
            <span class="badge badge-success tag-sale">
              <%= sale_percentage(skin.sale_price, skin.price_csmoney) %>% OFF
            </span>
          <% end %>
        </div>
        <div class="chili-pepper-text mb-0 market-prices">
          <br>
          <a href="https://api.whatsapp.com/send?phone=<%= skin.steam_account.user.ddi %><%= skin.steam_account.user.cell_phone %>
                   &text=Ol%C3%A1%2C%20fiquei%20interessado%20na%20skin:%20<%= skin.id %> - <%= skin.description %> <%= number_to_currency(skin.price_steam) %>"
             target="_blank" class=" badge badge-dark uppercase" style="float: right; margin-top: 15px;">
            <i class="fab fa-whatsapp" style="font-size: 30px;"></i>
          </a>
          <% if skin.price_steam > skin.price_csmoney %>
            <div>
              <%= image_tag('logo_steam.png', width: 28) %>
              <%= number_to_currency(skin.price_steam) %>
            </div>
          <% else %>
            <div>
              <%= image_tag('logo_csmoney.png', width: 28) %>
              <%= number_to_currency(skin.price_csmoney) %>
            </div>
          <% end %>
          <div>
            <%= image_tag('logo_without_name.png', width: 28) %>
            <%= number_to_currency(skin.sale_price) %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
<%= paginate @skins %>
